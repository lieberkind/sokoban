<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>

    <style>
        * { margin: 0; padding: 0; }
        canvas { 
            background: cyan;
            width: 304px;
            height: 272px;
        }
    </style>
</head>
<body>
    <canvas id="game"></canvas>
    <script>

        var level1 = [
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["p", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "b", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "b", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
            ["s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s", "s"],
        ];

        function Player(game, initPosX, initPosY) {
            this.game = game;
            this.position = {
                x: initPosX,
                y: initPosY
            }
        }

        Player.prototype.canMoveTo = function(dPosition) {
            var level = this.game.level;

            return dPosition.x < level[this.position.y].length &&
                dPosition.x >= 0 &&
                dPosition.y < level.length &&
                dPosition.y >= 0 &&
                level[dPosition.y][dPosition.x] !== 'b';
        };

        Player.prototype.draw = function() {
            var ctx = this.game.ctx;
            ctx.beginPath();
            ctx.rect(this.position.x * 16, this.position.y * 16, 16, 16);
            ctx.fillStyle = '#F00';
            ctx.fill();
            ctx.closePath();
        };

        Player.prototype.update = function() {
            var level = this.game.level;

            var dPosition;

            if(this.game.rightPressed) {
                dPosition = { x: this.position.x + 1, y: this.position.y};
            } else if(this.game.leftPressed) {
                dPosition = { x: this.position.x - 1, y: this.position.y};
            } else if(this.game.downPressed) {
                dPosition = { x: this.position.x, y: this.position.y + 1};
            } else if(this.game.upPressed) {
                dPosition = { x: this.position.x, y: this.position.y - 1};
            } else {
                dPosition = { x: this.position.x, y: this.position.y };
            }

            if(this.canMoveTo(dPosition)) {
                this.position = dPosition;
            }
        }

        function Block(game, posX, posY) {
            this.game = game;
            this.position = {
                x: posX,
                y: posY
            };
        }

        Block.prototype.draw = function() {
            this.game.ctx.beginPath();
            this.game.ctx.rect(this.position.x * 16, this.position.y * 16, 16, 16);
            this.game.ctx.fillStyle = '#CCC';
            this.game.ctx.fill();
            this.game.ctx.closePath();
        };

        Block.prototype.update = function() {};

        function Game(ctx) {
            this.ctx = ctx;
            this.gameObjects = [];
        }

        Game.prototype.draw = function() {
            this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
            this.gameObjects.forEach(function(gameObject) {
                gameObject.draw();
            });
        };

        Game.prototype.update = function() {
            this.gameObjects.forEach(function(gameObject) {
                gameObject.update();
            });
            this.resetInputs();
        };

        Game.prototype.resetInputs = function() {
            this.leftPressed = false;
            this.upPressed = false;
            this.rightPressed = false;
            this.downPressed = false;
        };

        Game.prototype.loadLevel = function(level) {
            var self = this;
            this.level = level;

            level.forEach(function(row, rowIdx) {
                row.forEach(function(field, fieldIdx) {
                    if(field === 'b') {
                        self.addGameObject(new Block(self, fieldIdx, rowIdx));
                    }

                    if(field === 'p') {
                        self.addGameObject(new Player(game, fieldIdx, rowIdx));
                    }
                });
            });
        }

        Game.prototype.addGameObject = function(obj) {
            this.gameObjects.push(obj);
        };

        var canvas = document.getElementById('game');
        canvas.width = 304;
        canvas.height = 272;

        var game = new Game(canvas.getContext('2d'));
        game.loadLevel(level1);

        addEventListener('keydown', function(e) {
            switch (e.keyCode) {
                case 37:
                    game.leftPressed = true;
                    break;
                case 38:
                    game.upPressed = true;
                    break;
                case 39:
                    game.rightPressed = true;
                    break;
                case 40:
                    game.downPressed = true;
                    break;
            }

            game.update();
            game.draw();
        });

        game.update();
        game.draw();
    </script>
</body>
</html>
